<!doctype html>
<!-- 
* Bootstrap Simple Admin Template
* Version: 2.1
* Author: Alexis Luna
* Website: https://github.com/alexis-luna/bootstrap-simple-admin-template
-->
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Login | Bootstrap Simple Admin Template</title>
    <link th:href="@{/vendor/bootstrap/css/bootstrap.min.css}" rel="stylesheet">
    <link th:href="@{/css/auth.css}" rel="stylesheet">
</head>

<body>
    <div class="wrapper">
        <div class="auth-content">
            <div class="card">
                <div class="card-body text-center">
                    <div class="mb-4">
                        <img class="brand" th:src="@{/img/bootstraper-logo.png}" alt="bootstraper logo">
                    </div>
                    <h6 class="mb-4 text-muted">Login to your account</h6>
                    <form id="loginForm">
                        <div class="mb-3 text-start">
                            <label for="username" class="form-label">Username</label>
                            <input type="text" id="username" class="form-control" placeholder="Enter your username"
                                required>
                        </div>
                        <div class="mb-3 text-start">
                            <label for="password" class="form-label">Password</label>
                            <input type="password" id="password" class="form-control" placeholder="Enter your password"
                                required>
                        </div>
                        <div class="mb-3 text-start">
                            <div class="form-check">
                                <input class="form-check-input" name="remember" type="checkbox" value="" id="check1">
                                <label class="form-check-label" for="check1">
                                    Remember me on this device
                                </label>
                            </div>
                        </div>
                        <button type="submit" id="btnLogin" class="btn btn-primary mb-4"
                            style="width:100%">Login</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <script th:src="@{/vendor/jquery/jquery.min.js}"></script>
    <script th:src="@{/vendor/bootstrap/js/bootstrap.min.js}"></script>
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

     <script>
        $(document).ready(function () {
            // Toggle password visibility
            $('#togglePassword').click(function () {
                const passwordInput = $('#password');
                const type = passwordInput.attr('type') === 'password' ? 'text' : 'password';
                passwordInput.attr('type', type);
                $('#eyeIcon').text(type === 'password' ? 'üëÅÔ∏è' : 'üôà');
            });

            // Handle form submission
            $('#loginForm').submit(function (e) {
                e.preventDefault();

                // Disable button dan tampilkan loading
                const loginBtn = $('#loginBtn');
                const btnText = $('#btnText');
                const btnSpinner = $('#btnSpinner');

                loginBtn.prop('disabled', true);
                btnText.addClass('d-none');
                btnSpinner.removeClass('d-none');

                // Ambil data dari form
                const username = $('#username').val();
                const password = $('#password').val();
                const rememberMe = $('#rememberMe').is(':checked');

                // Kirim request POST ke backend
                $.ajax({
                    url: '/auth/login', // Sesuaikan dengan endpoint backend Anda
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        username: username,
                        password: password
                    }),
                    success: function (response) {
                        // Simpan token ke localStorage atau sessionStorage
                        localStorage.setItem('authToken', response.token);
                        localStorage.setItem('username', response.username);
                        console.log("Token : ", response.token);
                       
                        // Redirect ke dashboard setelah 1 detik
                        setTimeout(function () {
                            window.location.href = '/dashboard'; // Sesuaikan dengan route dashboard Anda
                        }, 1000);
                    },
                    error: function (xhr, status, error) {
                        // Handle error
                        let errorMessage = 'Login failed. Please try again.';

                        if (xhr.responseJSON && xhr.responseJSON.message) {
                            errorMessage = xhr.responseJSON.message;
                        } else if (xhr.status === 401) {
                            errorMessage = 'Invalid username or password';
                        } else if (xhr.status === 403) {
                            errorMessage = 'Access denied';
                        } else if (xhr.status === 500) {
                            errorMessage = 'Server error. Please try again later.';
                        }

                        showAlert(errorMessage, 'danger');

                        // Enable button kembali
                        loginBtn.prop('disabled', false);
                        btnText.removeClass('d-none');
                        btnSpinner.addClass('d-none');
                    }
                });
            });
            // Check jika sudah login (ada token)
            const token = localStorage.getItem('authToken');
            if (token) {
                // Validasi token dengan backend (optional)
                // Jika valid, redirect ke dashboard
                window.location.href = '/dashboard';
            }
        });
    </script>
</body>

</html>